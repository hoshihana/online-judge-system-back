<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="pers.wjx.ojsb.repository.ProblemRepository">
    <insert id="addProblem" useGeneratedKeys="true" keyProperty="id">
        insert into problem(author_id, author_username, `name`, description, input_format, output_format, explanation, samples,
                            time_limit, memory_limit, visibility)
        values (#{authorId},#{authorUsername}, #{name}, #{description}, #{inputFormat}, #{outputFormat}, #{explanation},
                #{samples}, #{timeLimit}, #{memoryLimit}, #{visibility})
    </insert>
    <update id="updateProblem">
        update problem
        set `name`=#{name},
            description=#{description},
            input_format=#{inputFormat},
            output_format=#{outputFormat},
            explanation=#{explanation},
            samples=#{samples},
            time_limit=#{timeLimit},
            memory_limit=#{memoryLimit},
            visibility=#{visibility}
        where id = #{id}
    </update>
    <update id="increaseSubmit">
        update problem
        set submit = submit + 1
        where id = #{id}
    </update>
    <update id="setTestSet">
        update problem
        set test_set = 1
        where id = #{id}
    </update>
    <update id="increaseAccept">
        update problem
        set accept = accept + 1
        where id = #{id}
    </update>
    <delete id="deleteProblemById">
        delete
        from problem
        where id = #{id}
    </delete>
    <select id="getProblemById" resultType="pers.wjx.ojsb.pojo.Problem">
        select *
        from problem
        where id = #{id}
    </select>
    <select id="getProblemEntriesByAuthorId" resultType="pers.wjx.ojsb.pojo.ProblemEntry">
        select id, name, submit, accept
        from problem
        where author_id = #{authorId}
        order by id desc
            limit #{startIndex}, #{pageSize}
    </select>
    <select id="getProblemEntriesByName" resultType="pers.wjx.ojsb.pojo.ProblemEntry">
        select id, name, submit, accept
        from problem
        where `name` like concat('%', #{name}, '%')
            limit #{startIndex}, #{pageSize}
    </select>
    <select id="countProblemEntriesByName" resultType="java.lang.Integer">
        select count(*)
        from problem
        where `name` like concat('%', #{name}, '%')
    </select>
    <select id="getAuthorIdById" resultType="java.lang.Integer">
        select author_id
        from problem
        where id = #{id}
    </select>
    <select id="countProblemEntriesByAuthorId" resultType="java.lang.Integer">
        select count(*)
        from problem
        where author_id = #{authorId}
    </select>
    <select id="countProblemEntriesById" resultType="java.lang.Integer">
        select count(*)
        from problem
        where id = #{id}
    </select>
    <select id="getTestSet" resultType="java.lang.Boolean">
        select test_set
        from problem
        where id = #{id}
    </select>
    <select id="getMemoryLimit" resultType="java.lang.Integer">
        select memory_limit
        from problem
        where id = #{id}
    </select>

</mapper>